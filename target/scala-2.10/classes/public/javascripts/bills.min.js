$(function(){var bills={};var beginDate;var endDate;var populateBills=function(){jsRoutes.controllers.BillController.listBills().ajax({success:function(data){setCookie();var html=[];console.log(beginDate+"  "+endDate);$.each(data,function(i,bill){bills[bill.id]=bill});updateTableDisplay();addTableSorter()}})};var displayBills=function(){var html=[];$.each(bills,function(i,bill){if(!beginDate&&!endDate||bill.dueDate>=beginDate&&bill.dueDate<endDate)html.push(generateBillRow(bill))});$("#bills-table tbody").html(html.join(""));
updateTableSort(true);$(".updateRow.datepicker").datepicker()};var addBill=function(row){jsRoutes.controllers.BillController.addBill().ajax({data:{title:$(".billTitle input",row).val(),dueDate:$(".billDate input",row).val(),amount:parseFloat($(".billAmount input",row).val()),isRecuring:$(".billRecuring input",row).is(":checked")},success:function(data){if($.isArray(data))$.each(data,function(i,bill){bills[bill.id]=bill});else bills[data.id]=data;displayBills();updateTableSort(false)}})};var addBillCallback=
function(e){var row=generateBillFormRow();$("#bills-table tbody").prepend(row);$(".addRow .datepicker").datepicker()};var generateBillRow=function(bill){var date=new Date(bill.dueDate);var returnBill="\x3ctr data-id\x3d'"+bill.id+"' class\x3d'viewRow'\x3e"+"\x3ctd class\x3d'actionBox'\x3e\x3cinput type\x3d'checkbox'\x3e\x3c/td\x3e"+"\x3ctd class\x3d'billDate' \x3e"+(date.getUTCMonth()+1)+"/"+date.getUTCDate()+"/"+date.getUTCFullYear()+"\x3c/td\x3e \x3ctd class\x3d'billTitle'\x3e"+bill.title+"\x3c/td\x3e\x3ctd class\x3d'billAmount'\x3e"+
bill.amount.toFixed(2)+"\x3c/td\x3e\x3ctd class\x3d'billRecuring'\x3e"+"\x3cinput type\x3d'checkbox' disabled";if(bill.isRecuring)returnBill+=" checked";returnBill+="\x3e\x3c/td\x3e\x3c/tr\x3e";returnBill+=generateBillFormRow(bill);return returnBill};var generateBillFormRow=function(bill){var row;if(bill){var date=new Date(bill.dueDate);row="\x3ctr data-id\x3d'"+bill.id+"' class\x3d'updateRow' style\x3d'display: none'\x3e"+"\x3ctd\x3e \x3cdiv class\x3d'btn-group btn-group-sm'\x3e"+"\t\x3cbutton class\x3d'btn btn-info save' type\x3d'button'\x3e\x3cspan class\x3d'glyphicon glyphicon-ok'\x3e\x3c/span\x3e\x3c/button\x3e"+
"\t\x3cbutton class\x3d'btn btn-info cancel' type\x3d'button'\x3e\x3cspan class\x3d'glyphicon glyphicon-remove'\x3e\x3c/span\x3e\x3c/button\x3e"+"\x3c/div\x3e\x3c/td\x3e"+"\x3ctd class\x3d'billDate' sorttable_customkey\x3d'"+(date.getUTCMonth()+1)+"/"+date.getUTCDate()+"/"+date.getUTCFullYear()+"'\x3e"+"\x3cinput type\x3d'text' size\x3d'15' class\x3d'form-control datepicker ' value\x3d'"+(date.getUTCMonth()+1)+"/"+date.getUTCDate()+"/"+date.getUTCFullYear()+"'\x3e"+"\x3c/td\x3e \x3ctd class\x3d'billTitle' sorttable_customkey\x3d'"+
bill.title+"'\x3e"+"\x3cinput type\x3d'text' class\x3d'form-control ' value\x3d'"+bill.title+"'\x3e"+"\x3c/td\x3e\x3ctd class\x3d'billAmount' sorttable_customkey\x3d'"+bill.amount.toFixed(2)+"'\x3e"+"\x3cinput type\x3d'text' size\x3d'10' class\x3d'form-control ' value\x3d'"+bill.amount.toFixed(2)+"'\x3e"+"\x3c/td\x3e\x3ctd class\x3d'billRecuring'\x3e"+"\x3cinput type\x3d'checkbox'";if(bill.isRecuring)row+=" checked";row+="\x3e\x3c/tr\x3e"}else row="\x3ctr class\x3d'addRow'\x3e"+"\x3ctd\x3e \x3cdiv class\x3d'btn-group btn-group-sm'\x3e"+
"\t\x3cbutton class\x3d'btn btn-info save' type\x3d'button'\x3e\x3cspan class\x3d'glyphicon glyphicon-ok'\x3e\x3c/span\x3e\x3c/button\x3e"+"\t\x3cbutton class\x3d'btn btn-info cancel' type\x3d'button'\x3e\x3cspan class\x3d'glyphicon glyphicon-remove'\x3e\x3c/span\x3e\x3c/button\x3e"+"\x3c/div\x3e\x3c/td\x3e"+"\x3ctd class\x3d'billDate' \x3e"+"\x3cinput type\x3d'text' size\x3d'15' class\x3d'form-control datepicker'\x3e"+"\x3c/td\x3e \x3ctd class\x3d'billTitle'\x3e"+"\x3cinput type\x3d'text' class\x3d'form-control '\x3e"+
"\x3c/td\x3e\x3ctd class\x3d'billAmount'\x3e"+"\x3cinput type\x3d'text' size\x3d'10' class\x3d'form-control '\x3e"+"\x3c/td\x3e"+"\x3ctd class\x3d'billRecuring'\x3e"+"\x3cinput type\x3d'checkbox'\x3e"+"\x3c/td\x3e\x3c/tr\x3e";return row};var saveRow=function(event){var row=$(this).parent().parent().parent();if(row.hasClass("updateRow"))updateBill(row);else if(row.hasClass("addRow"))addBill(row)};var updateBillCallback=function(e){};var deleteBillCallback=function(e){var billIds=[];$("#bills-table .actionBox input[type\x3dcheckbox]:checked").each(function(i,
checkbox){billIds.push($(checkbox).closest("tr").attr("data-id"))});if(billIds.length>0){var confirmed=confirm("Remove "+billIds.length+" bill(s)?");if(confirmed){$.each(billIds,function(i,billId){deleteBill(billId);$("#bills-table tr[data-id\x3d'"+billId+"']").remove()});updateTableSort(false)}}};var deleteBill=function(billId){jsRoutes.controllers.BillController.deleteBill(billId).ajax({success:function(data){$("#bill-table tr[data-id\x3d'"+billId+"']").remove()}})};var setCookie=function(selectBox){if($(selectBox).attr("id")==
"tableMonth")$.cookie("billMonth",$(selectBox).val());else if($(selectBox).attr("id")=="tableYear")$.cookie("billYear",$(selectBox).val());if($.cookie("billMonth")!=="all"&&$.cookie("billYear")=="all"){$("#tableYear").val((new Date).getFullYear());$("#tableYear").change()}updateTableDisplay()};var setTableDateRange=function(){var monthCookie=$.cookie("billMonth");var yearCookie=$.cookie("billYear");console.log(monthCookie+" "+yearCookie);if(monthCookie=="all"&&yearCookie=="all"){beginDate=null;endDate=
null}else if(monthCookie=="all"&&yearCookie!="all"){beginDate=(new Date(yearCookie,0,1)).valueOf();endDate=(new Date(parseInt(yearCookie)+1,0,1)).valueOf()}else{beginDate=(new Date(yearCookie,monthCookie)).valueOf();monthCookie==11?endDate=(new Date(parseInt(yearCookie)+1,0)).valueOf():endDate=(new Date(yearCookie,parseInt(monthCookie)+1)).valueOf()}};var updateTableDisplay=function(){setTableDateRange();displayBills()};var updateTableDateRange=function(){var selectBox=this;setCookie(selectBox)};
var addTableSorter=function(){$("#bills-table").tablesorter({textExtraction:function(node){var customKey=$(node).attr("sorttable_customkey");return customKey||node.innerHTML},headers:{0:{sorter:false},4:{sorter:false}},sortList:[[1,0]]})};var updateTableSort=function(resort){var table=$("#bills-table");table.trigger("update",[resort])};$("#bills-table").on("click","#delete",deleteBillCallback);$("#bills-table").on("click","#updateButton",updateBillCallback);$("#bills-table").on("click","#add",addBillCallback);
$("#bills-table").on("click",".save",saveRow);$("#tableMonth").on("change",updateTableDateRange);$("#tableYear").on("change",updateTableDateRange);$("#tableYear").val($.cookie("billYear"));$("#tableMonth").val($.cookie("billMonth"));populateBills()});